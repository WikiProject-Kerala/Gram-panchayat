<!DOCTYPE html>
<html lang="ml">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.2/css/bulma.min.css">
   <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link href="./style.css" rel="stylesheet">
  <title>‡¥ï‡µá‡¥∞‡¥≥‡¥§‡µç‡¥§‡¥ø‡¥≤‡µÜ ‡¥™‡¥û‡µç‡¥ö‡¥æ‡¥Ø‡¥§‡µç‡¥§‡µÅ‡¥ï‡µæ</title>
</head>
<body>
 <section class="section">
    <div class="container">
	<div class="columns is-centered">
		<div class="column is-half has-text-centered">
      			<h1 class="title is-4">‡¥ï‡µá‡¥∞‡¥≥‡¥§‡µç‡¥§‡¥ø‡¥≤‡µÜ ‡¥™‡¥û‡µç‡¥ö‡¥æ‡¥Ø‡¥§‡µç‡¥§‡µÅ‡¥ï‡µæ ‡¥í‡¥±‡µç‡¥±‡¥®‡µã‡¥ü‡µç‡¥ü‡¥§‡µç‡¥§‡¥ø‡µΩ</h1>
		</div>
	</div>
    </div>
 </section>
 <div class="container">
   <div align=center><div class="dropdown">
     <label for="location-select">‡¥ú‡¥ø‡¥≤‡µç‡¥≤ ‡¥§‡¥ø‡¥∞‡¥û‡µç‡¥û‡µÜ‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡µÅ‡¥ï:</label>
      <select id="location-select">
        <option value="Q1419703">------</option>
        <option value="Q1419703">‡¥ï‡¥æ‡¥∏‡µº‡¥ó‡µã‡¥°‡µç</option>
        <option value="Q2980652">‡¥ï‡¥£‡µç‡¥£‡µÇ‡µº</option>
        <option value="Q1142979">‡¥ï‡µã‡¥¥‡¥ø‡¥ï‡µç‡¥ï‡µã‡¥ü‡µç</option>
        <option value="Q1364427">‡¥µ‡¥Ø‡¥®‡¥æ‡¥ü‡µç</option>
        <option value="Q1030918">‡¥Æ‡¥≤‡¥™‡µç‡¥™‡µÅ‡¥±‡¥Ç</option>
        <option value="Q1535742">‡¥™‡¥æ‡¥≤‡¥ï‡µç‡¥ï‡¥æ‡¥ü‡µç</option>
        <option value="Q2429655">‡¥§‡µÉ‡¥∂‡µç‡¥∂‡µÇ‡µº</option>
        <option value="Q1356097">‡¥é‡¥±‡¥£‡¥æ‡¥ï‡µÅ‡¥≥‡¥Ç</option>
        <option value="Q928959">‡¥Ü‡¥≤‡¥™‡µç‡¥™‡µÅ‡¥¥</option>
        <option value="Q1353354">‡¥ï‡µã‡¥ü‡µç‡¥ü‡¥Ø‡¥Ç</option>
        <option value="Q301821">‡¥á‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡¥ø</option>
        <option value="Q634935">‡¥™‡¥§‡µç‡¥§‡¥®‡¥Ç‡¥§‡¥ø‡¥ü‡µç‡¥ü</option>
        <option value="Q1356124">‡¥ï‡µä‡¥≤‡µç‡¥≤‡¥Ç</option>
        <option value="Q162612">‡¥§‡¥ø‡¥∞‡µÅ‡¥µ‡¥®‡¥®‡µç‡¥§‡¥™‡µÅ‡¥∞‡¥Ç</option>
      </select>
  </div>
  <div align=center><div class="dropdown">
      <label for="panchayat-select">‡¥™‡¥û‡µç‡¥ö‡¥æ‡¥Ø‡¥§‡µç‡¥§‡µç ‡¥§‡¥ø‡¥∞‡¥û‡µç‡¥û‡µÜ‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡µÅ‡¥ï:</label>
      <select id="panchayat-select" disabled>
        <option value="">...‡¥™‡¥û‡µç‡¥ö‡¥æ‡¥Ø‡¥§‡µç‡¥§‡µç</option>
      </select>
  </div>
</div>
</br>
     <div><div class="loading" id="loading-animation">
          <div class="loading-icon"></div>
     </div>
      <h5 class="subtitle is-5 has-text-centered" id="loading-animation">‡¥µ‡¥æ‡µº‡¥°‡µÅ‡¥ï‡µæ (‡¥é‡¥£‡µç‡¥£‡¥Ç)</h5>
      <h5 class="subtitle is-3 has-text-centered" id="wards-count"></h5>
<div class="columns is-mobile is-multiline is-centered">
     <div class="column is-narrow">
        <table class="table is-bordered centered-table" id="panchayat-table">
          <thead>
            <tr>
         	 <th>LGD ‡¥ï‡µã‡¥°‡µç <div class="popup-container">
  			<span> üõà</span>
  			<div class="popup-content">
    			<p>‡¥≤‡µã‡¥ï‡µç‡¥ï‡µΩ ‡¥ó‡¥µ‡µ∫‡¥Æ‡µÜ‡¥®‡µç‡¥±‡µç ‡¥°‡¥Ø‡¥±‡¥ï‡µç‡¥ü‡¥±‡¥ø‡¥Ø‡¥ø‡µΩ ‡¥ï‡µá‡¥®‡µç‡¥¶‡µç‡¥∞, ‡¥∏‡¥Ç‡¥∏‡µç‡¥•‡¥æ‡¥®, ‡¥±‡¥µ‡¥®‡µç‡¥Ø‡µÇ, ‡¥§‡¥¶‡µç‡¥¶‡µá‡¥∂‡¥∏‡µç‡¥µ‡¥Ø‡¥Ç‡¥≠‡¥∞‡¥£ ‡¥∏‡µç‡¥•‡¥æ‡¥™‡¥®‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ‡¥Ø‡µÅ‡¥Ç ‡¥Ö‡¥µ‡¥Ø‡µÅ‡¥ü‡µÜ ‡¥µ‡¥æ‡µº‡¥°‡µÅ‡¥ï‡µæ‡¥ï‡µç‡¥ï‡µÅ‡¥Ç ‡¥á‡¥®‡µç‡¥§‡µç‡¥Ø ‡¥∏‡µº‡¥ï‡µç‡¥ï‡¥æ‡µº ‡¥®‡µΩ‡¥ï‡µÅ‡¥®‡µç‡¥® ‡¥ï‡µã‡¥°‡µç</p></th>
         	 <th>LSG ‡¥ï‡µã‡¥°‡µç <div class="popup-container">
  			<span> üõà</span>
  			<div class="popup-content">
    			<p>‡¥ï‡µá‡¥∞‡¥≥ ‡¥§‡¥¶‡µç‡¥¶‡µá‡¥∂ ‡¥∏‡µç‡¥µ‡¥Ø‡¥Ç‡¥≠‡¥∞‡¥£ ‡¥µ‡¥ï‡µÅ‡¥™‡µç‡¥™‡µç ‡¥§‡¥¶‡µç‡¥¶‡µá‡¥∂ ‡¥∏‡µç‡¥•‡¥æ‡¥™‡¥®‡¥ô‡µç‡¥ô‡µæ ‡¥®‡µΩ‡¥ï‡µÅ‡¥®‡µç‡¥® ‡¥ï‡µã‡¥°‡µç</p></th>
         	 <th>SEC ‡¥ï‡µã‡¥°‡µç <div class="popup-container">
  			<span> üõà</span>
  			<div class="popup-content">
    			<p>‡¥ï‡µá‡¥∞‡¥≥ ‡¥∏‡¥Ç‡¥∏‡µç‡¥•‡¥æ‡¥® ‡¥§‡¥ø‡¥∞‡¥û‡µç‡¥û‡µÜ‡¥ü‡µÅ‡¥™‡µç‡¥™‡µç ‡¥ï‡¥Æ‡µç‡¥Æ‡µÄ‡¥∑‡µª ‡¥§‡¥¶‡µç‡¥¶‡µá‡¥∂ ‡¥∏‡µç‡¥•‡¥æ‡¥™‡¥®‡¥ô‡µç‡¥ô‡µæ‡¥ï‡µç‡¥ï‡µÅ‡¥Ç ‡¥µ‡¥æ‡µº‡¥°‡µÅ‡¥ï‡µæ‡¥ï‡µç‡¥ï‡µÅ‡¥Ç ‡¥®‡µΩ‡¥ï‡µÅ‡¥®‡µç‡¥® ‡¥ï‡µã‡¥°‡µç</p></th>
            </tr>
          </thead>
          <tbody id="panchayat-data">
          </tbody>
      </table>
</div>
  <style>
  #panchayat-table {
    display: table !important;
  }
  </style>
      <table class="table is-bordered centered-table" id="population-table">
          <thead>
            <tr>
                  <th>‡¥ú‡¥®‡¥∏‡¥Ç‡¥ñ‡µç‡¥Ø</th>
                  <th>‡¥™‡µÅ‡¥∞‡µÅ‡¥∑‡¥ú‡¥®‡¥∏‡¥Ç‡¥ñ‡µç‡¥Ø</th>
          	 <th>‡¥∏‡µç‡¥§‡µç‡¥∞‡µÄ‡¥ú‡¥®‡¥∏‡¥Ç‡¥ñ‡µç‡¥Ø</th>
            </tr>
          </thead>
          <tbody id="population-data">
          </tbody>
      </table>
    </div>
  </div>
</div>
    <script>
      const locationSelect = document.getElementById('location-select');
      const panchayatSelect = document.getElementById('panchayat-select');
      const panchayatTable = document.getElementById('panchayat-table');
      const populationTable = document.getElementById('population-table');
      const panchayatData = document.getElementById('panchayat-data');
      const populationData = document.getElementById('population-data');
      const loadingAnimation = document.getElementById('loading-animation');

      function fetchPanchayatList() {
        const selectedLocation = locationSelect.value;
        if (selectedLocation) {
          const sparqlQueryList = `
            SELECT ?panchayat ?panchayatLabel
            WHERE {
              ?panchayat wdt:P31 wd:Q2732840;
                        wdt:P131 wd:${selectedLocation};
                        rdfs:label ?panchayatLabel.
              FILTER(LANG(?panchayatLabel) = 'ml')
            }
            ORDER BY ?panchayatLabel
            LIMIT 150
          `;

          const url = `https://query.wikidata.org/bigdata/namespace/wdq/sparql?query=${encodeURIComponent(sparqlQueryList)}`;

          fetch(url, {
            headers: {
              'Accept': 'application/json'
            }
          })
            .then(response => response.json())
            .then(data => {
              const results = data.results.bindings;
              panchayatSelect.innerHTML = '<option value="">------</option>';
              results.forEach(result => {
                const panchayatURI = result.panchayat.value;
                const panchayatLabel = result.panchayatLabel.value;
                const option = document.createElement('option');
                option.value = panchayatURI;
                option.textContent = panchayatLabel;
                panchayatSelect.appendChild(option);
              });
              panchayatSelect.disabled = false;
            })
            .catch(error => {
              console.error('Error:', error);
            });
        } else {
          panchayatSelect.innerHTML = '<option value="">...‡¥™‡¥û‡µç‡¥ö‡¥æ‡¥Ø‡¥§‡µç‡¥§‡µç</option>';
          panchayatSelect.disabled = true;
          panchayatTable.style.display = 'none';
          populationTable.style.display = 'none';
        }
      }

      function fetchPanchayatData() {
        const selectedPanchayatURI = panchayatSelect.value;
        if (selectedPanchayatURI) {
          const sparqlQueryData = `
            SELECT ?panchayatLabel ?population ?malePopulation ?femalePopulation ?LGDcode ?LSGcode ?SECcode (COUNT(?wards) AS ?wardsCount)
            WHERE {
              <${selectedPanchayatURI}> rdfs:label ?panchayatLabel.
               OPTIONAL { <${selectedPanchayatURI}> wdt:P1082 ?population }.
               OPTIONAL { <${selectedPanchayatURI}> wdt:P1540 ?malePopulation }.
               OPTIONAL { <${selectedPanchayatURI}> wdt:P1539 ?femalePopulation }.
               OPTIONAL { <${selectedPanchayatURI}> wdt:P527 ?wards }.
               OPTIONAL { <${selectedPanchayatURI}> wdt:P6425 ?LGDcode }.
               OPTIONAL { <${selectedPanchayatURI}> wdt:P8573 ?LSGcode }.
               OPTIONAL { <${selectedPanchayatURI}> wdt:P11817 ?SECcode }.
              FILTER(LANG(?panchayatLabel) = 'ml')
            }
          GROUP BY ?panchayatLabel ?population ?malePopulation ?femalePopulation ?LGDcode ?LSGcode ?SECcode
            LIMIT 1
          `;

          const url = `https://query.wikidata.org/bigdata/namespace/wdq/sparql?query=${encodeURIComponent(sparqlQueryData)}`;

          panchayatTable.style.display = 'none';
          populationTable.style.display = 'none';
          loadingAnimation.style.display = 'flex';

          const wardsCountElement = document.getElementById('wards-count');

          fetch(url, {
            headers: {
              'Accept': 'application/json'
            }
          })
            .then(response => response.json())
            .then(data => {
              const panchayat = data.results.bindings[0];
              if (panchayat) {
                const panchayatLabel = panchayat.panchayatLabel?.value || 'N/A';
                const wardsCount = panchayat.wardsCount?.value || 'N/A';
                const population = panchayat.population?.value || 'N/A';
                const malePopulation = panchayat.malePopulation?.value || 'N/A';
                const femalePopulation = panchayat.femalePopulation?.value || 'N/A';
                const LGDcode = panchayat.LGDcode?.value || 'N/A';
                const LSGcode = panchayat.LSGcode?.value || 'N/A';
                const SECcode = panchayat.SECcode?.value || 'N/A';

                // Set the wardsCount value
                wardsCountElement.textContent = wardsCount;

                const panchayatRow = `
                  <tr>
                    <td class="has-text-centered">${LGDcode}</td>
                    <td class="has-text-centered">${LSGcode}</td>
                    <td class="has-text-centered">${SECcode}</td>
                  </tr>
                `;
                panchayatData.innerHTML = panchayatRow;

                const populationRow = `
                  <tr>
                    <td class="has-text-centered">${population}</td>
                    <td class="has-text-centered">${malePopulation}</td>
                    <td class="has-text-centered">${femalePopulation}</td>
                  </tr>
                `;
                populationData.innerHTML = populationRow;

                panchayatTable.style.display = 'block';
                populationTable.style.display = 'block';
              } else {
                panchayatData.innerHTML = '<tr><td colspan="3">‡¥°‡¥æ‡¥±‡µç‡¥± ‡¥ï‡¥£‡µç‡¥ü‡µÜ‡¥§‡µç‡¥§‡¥ø‡¥Ø‡¥ø‡¥≤‡µç‡¥≤</td></tr>';
                populationData.innerHTML = '<tr><td colspan="3">‡¥°‡¥æ‡¥±‡µç‡¥± ‡¥ï‡¥£‡µç‡¥ü‡µÜ‡¥§‡µç‡¥§‡¥ø‡¥Ø‡¥ø‡¥≤‡µç‡¥≤</td></tr>';
                panchayatTable.style.display = 'none';
                populationTable.style.display = 'none';
              }

              loadingAnimation.style.display = 'none';
            })
            
        } else {
          panchayatData.innerHTML = '';
          populationData.innerHTML = '';
          panchayatTable.style.display = 'none';
          populationTable.style.display = 'none';
        }
      }
      locationSelect.addEventListener('change', fetchPanchayatList);
      panchayatSelect.addEventListener('change', fetchPanchayatData);
    </script>
<section class="section">
    		<div class="container">
			<button class="btn"><a href="https://map.opendatakerala.org/" style="color:black; text-decoration: none; right: 0;"> View and Download the Map </a></button>
		</div>
		<div class="column is-half has-text-centered">
  	</section>
<footer class="footer">
  <div class="container">
    <div class="content has-text-centered">
      <p>
        <p><a href="https://www.wikidata.org/"><img src="./Images/Wikidata_Stamp_Rec_Light.png"></a></p>
        The content is licensed <a href="https://creativecommons.org/publicdomain/zero/1.0/">under Creative Commons CC0</a>
      <p> <strong>Dashboard</strong> designed and developed by <a href="https://www.wikidata.org/wiki/User:Gnoeee">Gnoeee</a>
      </p>
    </div>
  </div>
</footer>
  </body>
</html>